<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <!-- 
    D-Bus policy for op-dbus Agent Services
    
    Agents register as: org.dbusmcp.Agent.{AgentType}
    Example: org.dbusmcp.Agent.RustPro
    
    The ChatActor discovers these via introspection and
    creates tools that call the Execute method.
  -->

  <!-- Allow root to own agent services -->
  <policy user="root">
    <allow own_prefix="org.dbusmcp"/>
    <allow send_destination_prefix="org.dbusmcp"/>
    <allow receive_sender_prefix="org.dbusmcp"/>
  </policy>

  <!-- Allow op-dbus user to own and call -->
  <policy user="op-dbus">
    <allow own_prefix="org.dbusmcp"/>
    <allow send_destination_prefix="org.dbusmcp"/>
    <allow receive_sender_prefix="org.dbusmcp"/>
  </policy>

  <!-- Allow any user to call agent methods (for chat interface) -->
  <policy context="default">
    <!-- Agent interface -->
    <allow send_destination_prefix="org.dbusmcp.Agent"
           send_interface="org.dbusmcp.Agent"/>
    
    <!-- Standard D-Bus introspection -->
    <allow send_destination_prefix="org.dbusmcp"
           send_interface="org.freedesktop.DBus.Introspectable"/>
    <allow send_destination_prefix="org.dbusmcp"
           send_interface="org.freedesktop.DBus.Properties"/>
    <allow send_destination_prefix="org.dbusmcp"
           send_interface="org.freedesktop.DBus.Peer"/>
  </policy>
</busconfig>
